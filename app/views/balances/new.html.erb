<div class="tab_content">
  <h1 class="title">消费内容列表</h1>
  <%= error_messages_for :balance %>
  <% form_for([@order,@balance],:html => {:class => 'balance-form'}) do |f| -%>
    <div class="listcontent_w clearfix cleft">
      <ul class="clearfix">
        <li class="cleft">
          <div class="w3">会员：</div>
          <div class="w4"><%= @order.member_name %></div>
        </li>
        <% if @order.is_member? %>
          <li class="cleft">
            <div class="w3">会员卡：</div>
            <div class="w4">
              <%= @current_card.card_serial_num %>  类型:<%= @current_card.card.card_type_desc %>
               余额(次):<%= @current_card.left_fee_value %>
            </div>
          </li>
        <% end %>
        <li class="cleft">
          <div class="w3">场地：</div>
          <div class="w4">
            <%= @book_record.court.name %><%= @book_record.record_date.to_s(:db)%>
            <%= @book_record.start_hour %>:00-<%= @book_record.end_hour %>:00
          </div>
        </li>
        <li class="cleft">
          <div class="w3">场地消费：</div>
          <div class="w4">
            <span class="red" id="book_record_fee">
              <% if @balance.use_card_counter_to_balance?  -%>
                <%= @balance.count_amount %>次
                <%if @order.is_order_use_zige_card? -%>
                <%= f.hidden_field  :book_record_realy_amount,:size => '10' %>
                <%end -%>
              <% else -%>
                ￥<%= f.text_field  :book_record_realy_amount,:size => '10' %>元
              <% end -%>
            </span>
            <% if @order.is_member? -%>
             <%if @balance.should_use_card_to_blance? -%>
              <label class="labelRadio"><%= f.radio_button :balance_way, Balance::Balance_Way_Use_Card,:class => 'balance_way' %>用卡</label>
             <%end -%>
              <% if @balance.should_use_counter_to_balance? -%>
              <input type="hidden" name="balance[count_amount]" id="br_conter_amount" value="<%= @order.hours  %>" />
                <label class="labelRadio"><%= f.radio_button :balance_way, Balance::Balance_Way_Use_Counter,:class => 'balance_way'%>计次</label>
              <%end -%>
            <%  end -%>
            <label class="labelRadio"><%= f.radio_button :balance_way, Balance::Balance_Way_Use_Cash,:class => 'balance_way' %>现金</label>
            <label class="labelRadio"><%= f.radio_button :balance_way, Balance::Balance_Way_Use_Bank,:class => 'balance_way' %>银行</label>
            <label class="labelRadio"><%= f.radio_button :balance_way, Balance::Balance_Way_Use_Post,:class => 'balance_way' %>post机</label>
            <label class="labelRadio"><%= f.radio_button :balance_way, Balance::Balance_Way_Use_Check ,:class => 'balance_way'%>支票</label>
            <label class="labelRadio"><%= f.radio_button :balance_way, Balance::Balance_Way_Use_Guazhang,:class => 'balance_way' %>挂账</label>
          </div>
        </li>
        <li class="cleft">
          <div class="w3">其他消费：</div>
          <div class="w4">
            <span class="red">
               ￥<%= f.text_field :goods_realy_amount,:size => '10' %>元
            </span>
            <% if @order.should_use_card_to_balance_goods? %>
              <label class="labelRadio"><%= f.radio_button :goods_balance_type, Balance::Balance_Way_Use_Card %>用卡</label>
            <%end%>
            <label class="labelRadio"><%= f.radio_button :goods_balance_type, Balance::Balance_Way_Use_Cash %>现金</label>
            <label class="labelRadio"><%= f.radio_button :goods_balance_type, Balance::Balance_Way_Use_Post %>post机</label>
            <label class="labelRadio"><%= f.radio_button :goods_balance_type, Balance::Balance_Way_Use_Check %>支票</label>
            <label class="labelRadio"><%= f.radio_button :goods_balance_type, Balance::Balance_Way_Use_Guazhang %>挂账</label>
          </div>
        </li>
        <li class="cleft">
          <div class="w3">消费合计：</div>
          <div class="w4">
            <span id="amount_fee_str">￥<%= @balance.balance_realy_amount %>元；<%= @balance.count_amount %>次场地</span>
            <%= f.hidden_field 	:book_record_amount %>
            <%= f.hidden_field 	:goods_amount %>
            <%= f.hidden_field	:operation %>
          </div>
        </li>
      </ul>
      <input type="hidden" name="batch_id" value="<%= params[:batch_id] %>" />
      <div class="btn t_center">
        <input  class="change-amount" type="button"  value="变更总价"/>
        <input  class="balance"  	  type="button"  value="支付"/>
        <input  name="print"   		  type="button"  value="打印收条" onClick=""/>
      </div>
    </div>
  <% end -%>
  <% unless @good_items.blank? %>
    <%= render :partial => "/orders/order_items",:locals => {:good_items => @good_items||[],:order => @order} %>
  <% end %>
</div>
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
      <% if @order.is_order_use_zige_card? -%>
        $('.balance_way').click(function(){
          var other_amount = $("#balance_goods_realy_amount").val();
          var amount = $('#balance_book_record_realy_amount').val();
          var count_amount = $('#br_conter_amount').val();
          if($('.balance_way:input:checked').val() == 7){
            var amount_info  = count_amount+'次';
            if(other_amount){amount_info = ((other_amount+"元;")+amount_info);}
            $('#book_record_fee').text(count_amount+'次').append(
              $('<input type="hidden" />').val(amount).attr('id','balance_book_record_realy_amount').
              attr('name','balance[book_record_realy_amount]'));
            $('#amount_fee_str').text(amount_info);
          }else{
            $('#book_record_fee').html(
              $('<input type="text" />').val(amount).attr('id','balance_book_record_realy_amount').
              attr('name','balance[book_record_realy_amount]'));
            var amount_fee = parseInt(amount);
            if(other_amount){amount_fee += parseInt(other_amount) }
            $('#amount_fee_str').text(amount_fee+"元;");
          }
        });
      <% end -%>
      $('.change-amount').click(function(){
        if(confirm('确定要变总价么？')){
          $('#balance_operation').val('change');
          $('.balance-form').submit();
        }
        return false;
      });
      $('.balance').click(function(){
        if(confirm('确定要结算么？？')){
          $('#balance_operation').val('balance');
          $('.balance-form').submit();
        }
        return false;
      });
    });
  </script>