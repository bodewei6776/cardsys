<% if flash[:notice] %>
  <div id='errorExplanation'><h2>出错啦</h2><p> <%= flash[:notice]%> </p></div>
<%end%>

<div class="w96">
  <div class=" r_bt" >
    <div class=" r_bt_l" >
      <div class=" r_bt_l_a" ></div>
      <div class=" r_bt_l_c fb white" >购买商品</div>
    </div>
    <div class=" r_bt_r" >
         <button  value="添加商品" class = "submit2 hand" href='/goods/goods' id='goods-list'>添加商品</button>
    </div>
  </div>


  <div class='fformbox_nr'>
    <%= form_tag  create_good_buy_balances_path ,:id => "balance_form" do |f|%>
      <ul>
        <li> 
        <div class='w1'> 是否是会员：</div>
        <div class='w1'>
          <%= radio_button_tag "","",false,:onclick => "show_div($(this),'member')",:id => "radio_yes"%>是
          <%= radio_button_tag "","",false,:onclick => "show_div($(this),'sanke')",:id => "radio_no"%>否
          <%= hidden_field_tag "member","member",:id=> "member_or_not"%>
        </div>
        </li>
      </ul>

      <div id='member'>

        <ul> 
          <li>
          <div class='w1'>
            会员姓名：
          </div>
          <div class='w2'>
            <input type="text" name="member_name" user_autocomplete='/book_records/complete_for_members' id='member_name'/>
            <input type="hidden" name="member_id" id='member_id'/>
          </div>

          <div class='w1'>
            会员卡号：
          </div>
          <div class='w2'>
            <p id='cards'><select name='member_card_id'></select></p>
            <p id='notice' style='color:red;'></p>
          </div>
          </li>
        </ul>

        <ul>
          <li>
          <div class='w1'>支付方式:</div>
          <div class='w2'>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Card,false,:class => 'balance_way' %>用卡</label>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Cash,false,:class => 'balance_way' %>现金</label>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Bank,false,:class => 'balance_way' %>银行</label>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Post,false,:class => 'balance_way' %>post机</label>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Check ,false,:class => 'balance_way'%>支票</label>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Guazhang,false,:class => 'balance_way' %>挂账</label>

          </div>
          </li>

        </ul>
      </div>

      <div id='sanke'>
        <ul>
          <li>
          <div class='w1'>
            散客姓名：
          </div>
          <div class='w2'>
            <input type="text"class="inputtext"  value='散客' id='sanke_name'/>
          </div>
          </li>
        </ul>
        <ul>
          <li>
          <div class='w1'>
            支付方式:
          </div>
          <div class='w2'>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Cash,false,:class => 'balance_way'%>现金</label>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Bank,false,:class => 'balance_way' %>银行</label>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Post,false,:class => 'balance_way' %>post机</label>
            <label class="labelRadio"><%= radio_button_tag :balance_way, Balance::Balance_Way_Use_Check ,false,:class => 'balance_way'%>支票</label>

          </div>
          </li>

        </ul>
      </div>
    </div>
    <div class="h10"></div>
    <%= submit_tag "付款",:class => "submit2 hand button"%>

    <%= link_to "清空购物车",clear_goods_balances_path,:class => "submit2 hand",:style => "padding: 3px 7px;"%>
  <% end%>
  <div class="h10"></div>
</div>

  <% unless cart.blank? %>
    <div class="infobox_bt"><p>商品消费列表</p></div>
    <div class="table">
      <ul class="bttitle black fb ">
        <li class="w5">序号</li>
        <li class="w10">商品名称</li>
        <li class="w10">商品价格</li>
        <li class="w15">数量</li>
        <li class="w15">总额</li>
        <li class="w15">操作</li>
      </ul>

      <% cart.line_items.each_with_index do |li,index|%>
        <ul class="table_items">
          <li class="w5"><%= index + 1 %></li>
          <li class="w10"><%= li.product.name %></li>
          <li class="w10"><%= li.product.price %></li>
          <li class="w15"><%= li.quantity %></li>
          <li class="w15"><%= li.quantity * li.product.price %></li>
          <li class="w15">
          <%= link_to "删除", "",:class => 'destory_order_item' %>
          </li>
        </ul>
      <% end %>
    </div>

    <div class='h10'></div>


  <% end %>



<script type='text/javascript'>
  function show_div(dom, id){
    $('#sanke').hide();$('#member').hide();
    $('#radio_yes').attr('checked',false);
    $('#radio_no').attr('checked',false);
    dom.attr('checked',true);
    $('#' + id +'').show(); 
    $('#member_or_not').attr('value',id);
  } 
<% if @order.is_member? %>
  show_div($('#radio_yes'),'member');
<% else%>
  show_div($('#radio_no'),'sanke');
<% end %>


$(document).ready(function(){
    $("#goods-list").colorbox({width:"900", height:"700", iframe:true});
    userAutocomplete();
    goodAutocomplete();
    $('#quantity').blur(function(){
      var quantity = $(this).val();
      if(isNaN(quantity)){
      alert('请输入正确数量');
      $(this).focus();
      return false;
      }
      else{
      $('#sub_total').text(parseInt(quantity) *$('#price').text());
      }

      });
    });

$("#balance_form").submit(function(){
    if($('#member_or_not').attr('value') == "member"){
    if($('#member_name').attr('value') == ""){ alert("会员姓名不能为空"); return false; }
    if($('#member_id').attr('value') == ""){ alert("会员卡号不能为空"); return false;}
    if($('#member input[type=radio]:checked').size() == 0){alert("请选择支付方式");return false;}
    }
    else{
    if($('#sanke_name').attr('value') == ""){ alert("散客姓名不能为空"); return false; }
    if($('#sanke input[type=radio]:checked').size() == 0){alert("请选择支付方式");return false;}
    }

    });

  </script>

