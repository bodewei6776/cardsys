.w96
.r_bt
  .r_bt_l
    .r_bt_l_a
    .r_bt_l_c.fb.white 会员卡绑定
  .r_bt_r
.fform
  - if @notice
    #errorExplanation
      %h2 提示
      %p= @notice
  .fformbox
    .fformbox_bt
      %p 会员卡绑定
    .fformbox_nr
      %form#search_form.form-profile{:action => "/members/member_card_bind_index", :method => "post"}
        %ul
          %li
            .w1 会员名称：
            .w2
              %input{:autocomplete => "/members/autocomplete_name", :name => "member_name", :type => "text", :value => params[:member_name]}/
              - unless @member.blank?
                = link_to '绑定卡类模板', {:action => "member_card_bind_list", :member_id => @member.nil? ? 0 : @member.id}, :class => "member_card_bind_index",:style=>'color:red;'
            .w1 卡名称：
            .w2
              %a#card_name{:style => "color:blue;"}
      = form_for(@member_card, :url => {:action => "member_card_bind_update"}, :html => {:id=>"member_card_form",:class => "form-profile"}) do |f|
        %ul
          %li
            .w1 会员卡号：
            .w2
              %input{:name => "member_id", :type => "hidden", :value => @member && @member.id}/
              %input#binded_card_id{:name => "binded_card_id", :type => "hidden", :value => params[:binded_card_id]}/
              %input#binded_card_type{:name => "binded_card_type", :type => "hidden", :value => params[:binded_card_type]}/
              %input#card_serial_num{:name => "member_card[card_serial_num]", :type => "text", :value => ""}/
            .w1 卡有效期：
            .w2
              %input.date-type-input{:name => "member_card[expire_date]", :type => "text", :value => (Time.now + 6.month).to_chinese_mdh}/
        %ul
          %li
            .w1 充值金额：
            .w2
              %input#card_type_name{:name => "member_card[left_fee]", :type => "text", :value => ""}/
            .w1 充值次数：
            .w2
              %input{:name => "member_card[left_times]", :type => "text", :value => ""}/
        %ul{:style => "height:80px;"}
          %li
            .w1 描述：
            .ww2
              %textarea{:cols => "45", :name => "member_card[description]", :rows => "4"}= @member_card && @member_card.description
  .h10
  .input_bd
    %button.submit1.hand{:onclick => "fsubmit();return false;", :type => "submit"} 提交
  .clear
.h10
.r_bt
  .r_bt_l
    .r_bt_l_a
    .r_bt_l_c.fb.white 会员卡列表
  .r_bt_r
.table
  %ul.bttitle.black.fb
    %li.w5 序号
    %li.w10 卡名称
    %li.w10 卡类型
    %li.w15 卡余额/余次
    %li.w15 有效期
    %li.w15 授权人
    %li.w10 取消绑定
  - unless @member_cards.blank?
    - @member_cards.each_with_index do |member_card,index|
      %ul.table_items
        %li.w5= index + 1
        %li.w10= member_card.card_serial_num
        %li.w10= member_card.card_type_in_chinese
        %li.w15= member_card.left_fee_value
        %li.w15= (member_card.expire_date.to_chinese_mdh)
        %li.w15
          - for granter in generate_granter_options(@member)
            - if @member.is_granter(granter[1], member_card.id)
              = granter[0]
          = link_to '添加授权人', {:action => :granter_new, :member_id => @member.id, :member_card_id => member_card.id}, :class => "granter_new"
        %li.w10
          = link_to '注销此卡', {:action => :member_card_freeze, :member_id => @member.id, :member_card_id => member_card.id, :type => 1}, :confirm => "确定要进行此操作？"
.h10
.pages
.h10

:javascript
  function fsubmit(){
    var card_serial_num = $("#card_serial_num")[0].value;
    if(""==card_serial_num){ alert("请选择卡类型模板！"); return;}
    var fee = $("#card_type_name")[0].value;
    if(""!=fee && !isNumTemp(fee)){
      alert("充值数必须为有效数字！");
      $("#card_type_name")[0].focus();
      return;
    }
    var form = $("#member_card_form");
    form.submit();
  }

  function isNumTemp(obj){
    var re = /^[1-9]\d*$/;
    return re.test(obj);
  }
  $(".member_card_bind_index").colorbox({width:"50%", height:"60%", iframe:false});
  $(".granter_new").colorbox({width:"90%", height:"60%", iframe:false});

